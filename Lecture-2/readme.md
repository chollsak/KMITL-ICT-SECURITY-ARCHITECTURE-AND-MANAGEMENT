***Lecture 2 : BASICS OF NETWORKS AND PROTOCOLS - SECURITY ISSUES***

## การทบทวน

**ความปลอดภัยของเครือข่ายมีความซับซ้อนมาก**
- มีแหล่งที่มาของภัยคุกคามหลายประการ
- มีประเภทของช่องโหว่หลายประเภท
- บางอย่างไม่เกี่ยวข้องกับ “เครือข่าย” โดยตรง แต่เครือข่ายให้การเข้าถึง
- การโจมตีที่สำเร็จเพียงครั้งเดียวอาจนำไปสู่การโจมตีอื่นๆ ได้!
- ต้องการการดูแลอย่างมากและบางครั้งอาจถึงขั้นความระมัดระวังสูง


## บทเรียนนี้

**พิจารณาพื้นฐานบางประการของโปรโตคอลเครือข่าย**
- เข้าใจช่องโหว่บางประการผ่านตัวอย่างบางอย่าง
- ภาพรวมของการโจมตีที่แตกต่างกัน
  - รายละเอียดของการโจมตีอื่นๆ จะได้รับการพิจารณาในสัปดาห์หน้า



## ตัวอย่าง

- IP Address (ที่อยู่ IP)
- MAC Address (ที่อยู่ MAC)

- ARP (Address Resolution Protocol)
- DHCP (Dynamic Host Configuration Protocol)
- BOOTP (Bootstrap Protocol)

- RIP (Routing Information Protocol)
- OSPF (Open Shortest Path First)

- BGP (Border Gateway Protocol)
- PPP (Point-to-Point Protocol)

- Core (หลัก)
- Root DNS Server (เซิร์ฟเวอร์ DNS หลัก)

- DNS (Domain Name System)
- DHCP (Dynamic Host Configuration Protocol)
- Telnet
- FTP (File Transfer Protocol)
- HTTP (Hypertext Transfer Protocol)
- RPC (Remote Procedure Call)
- P2P (Peer-to-Peer)
- POP (Post Office Protocol)/IMAP (Internet Message Access Protocol)
- SMTP (Simple Mail Transfer Protocol)

- Oscar

## ความซับซ้อน!

**โปรโตคอลหลายตัวในหลายชั้น**
- **ชั้นลิงก์** - Ethernet & 802.11 เป็นหลัก
- **ชั้นเครือข่ายและโปรโตคอลเสริม** - IP, ICMP, ARP, DNS, DHCP, ...
- **ชั้นการขนส่ง** - TCP และ UDP เป็นหลัก
- **แอปพลิเคชัน** - HTTP, SMTP, FTP, Telnet, IM, RSS feeds, บริการอื่นๆ


## แนวคิดพื้นฐาน

![alt text](/Lecture-2/img/tcp-ip-op.png)

**แผนภาพการทำงานของ TCP/IP**



## การสื่อสารข้ามเครือข่าย

**กระบวนการสื่อสาร**
- กระบวนการสื่อสารทั่วไปมักจะมีด้านลูกค้าและด้านเซิร์ฟเวอร์
  - กระบวนการสองตัวบนโฮสต์สองตัวที่สื่อสารกันโดยใช้ซ็อกเก็ต
  - ซ็อกเก็ตเหมือนกับประตูที่ข้อความถูกส่งและรับ
    - อินเตอร์เฟซระหว่างกระบวนการแอปพลิเคชันและชั้นการขนส่ง

**การระบุการสื่อสาร**
- ที่อยู่ IP ที่ไม่ซ้ำกันทั่วโลก
- หมายเลขพอร์ตฝั่งรับ

## กระบวนการ and Sockets
![alt text](/Lecture-2/img/socket.png)


## พอร์ตและเซิร์ฟเวอร์

**ลูกค้าติดต่อเซิร์ฟเวอร์ในตอนแรกสำหรับการสื่อสารทั้งหมด**
- เซิร์ฟเวอร์ควรตอบสนองต่อการติดต่อเริ่มต้น – มันจะฟังที่พอร์ต
  - มันมี “ซ็อกเก็ตอ็อบเจ็กต์” เริ่มต้นเพื่อรับการเชื่อมต่อ
  - มันสร้างซ็อกเก็ตใหม่ที่อุทิศให้กับลูกค้าเฉพาะหลังจากการเชื่อมต่อ
- ซ็อกเก็ตอ็อบเจ็กต์เริ่มต้นคือสิ่งที่เราหมายถึงเป็น “พอร์ตเปิด”
  - จริงๆ แล้วมันเป็นอ็อบเจ็กต์ครึ่งเปิด

**พอร์ตหมายเลข**
- พอร์ตหมายเลขตามขนบธรรมเนียมมักจะมีหมายเลขต่ำ
  - ขนบธรรมเนียมไม่เสมอไปตาม
  - ใน UNIX และระบบปฏิบัติการ UNIX-like, หมายเลขพอร์ตที่ต่ำกว่าหมายเลข 1024 เป็นพอร์ตที่มีสิทธิ์
    - เท่านั้น “root” สามารถสร้างพอร์ตเหล่านี้
    - ระบบระยะไกลสามารถไว้วางใจในความถูกต้องของพอร์ตเหล่านี้

**หมายเลขพอร์ตมาตรฐานบางประการ**
- เว็บเซิร์ฟเวอร์ (http) – 80, (https) - 443
- DNS – 53
- เซิร์ฟเวอร์เมล (smtp) – 25; SSH – 22
- เซิร์ฟเวอร์ Telnet – 23; FTP – 20 และ 21
- POPv2 - 109, POPv3 - 110, IMAP - 143

---

## การทบทวน TCP

**เรารู้จัก TCP ว่าเป็น**
- โปรโตคอลชั้นการขนส่งที่ถูกขนส่งโดย IP
- “แพ็กเกจ” ของ TCP เรียกว่า เซ็กเมนต์ (Segment) และจะถูกระบุด้วยพอร์ตต้นทาง (Source Port) และพอร์ตปลายทาง (Destination Port)
- IP เป็นโปรโตคอลที่ไม่เชื่อถือได้ - TCP รักษาลำดับของแพ็กเกจให้ถูกต้องและจัดการการยืนยัน (Acknowledgment) และการส่งซ้ำ (Retransmission) ของแพ็กเกจที่หายไป
- TCP ให้การควบคุมการไหล (Flow Control)
  - จะปรับการไหลของแพ็กเกจถ้าผู้รับไม่สามารถจัดการกับอัตราการส่งแพ็กเกจที่ส่งได้
  - หากแพ็กเกจถูกทิ้งเนื่องจากความหนาแน่น (Congestion) TCP จะลดอัตราการส่งโดยการเปลี่ยนขนาดของหน้าต่างความหนาแน่น (Congestion Window Size)
  - จำกัดจำนวนเซ็กเมนต์ที่ส่งไป แต่ยังไม่ได้รับการยืนยัน

## โครงสร้างของ TCP Segment

**มีธง (Flag) หกตัว**
- **ACK** - แสดงว่าฟิลด์ ACK ถูกต้อง
- **RST**, **SYN**, และ **FIN** ใช้สำหรับการตั้งค่าและการยุติการเชื่อมต่อ
- **PSH** - ส่งข้อมูลไปยังชั้นที่สูงขึ้นทันที
- **URG** - มีข้อมูลเร่งด่วน

**โครงสร้าง TCP Segment**
- **Source Port** - พอร์ตต้นทาง
- **Dest Port** - พอร์ตปลายทาง
- **Sequence Number** - หมายเลขลำดับ
- **ACK Number** - หมายเลขการยืนยัน
- **HDR LEN** - ความยาวของหัว
- **Rec Win Size** - ขนาดหน้าต่างการรับ
- **Checksum** - ตรวจสอบความถูกต้อง
- **Other Stuff** - อื่นๆ

## การจัดการการเชื่อมต่อ TCP

**ลูกค้าต้องการเริ่มต้นการเชื่อมต่อกับเซิร์ฟเวอร์**
- ส่งเซ็กเมนต์ TCP พิเศษไปยังเซิร์ฟเวอร์ที่มีบิต SYN ตั้งค่าเป็น 1
  - หมายเลขลำดับเริ่มต้นคือ `client_isn`
  - เรียกว่า SYN Segment
- เซิร์ฟเวอร์รับ SYN Segment
  - จัดสรรบัฟเฟอร์และตัวแปรสำหรับการเชื่อมต่อและตอบกลับ
  - การตอบกลับมี SYN = 1, หมายเลขการยืนยัน = `client_isn + 1`
  - หมายเลขลำดับคือ `server_isn`
  - เรียกว่า SYNACK Segment
- การเชื่อมต่อเสร็จสมบูรณ์

![alt text](/Lecture-2/img/tcpconnection.png)

## สถานะของ TCP - ลูกค้าและเซิร์ฟเวอร์
![alt text](/Lecture-2/img/tcpState.png)
## การยุติการเชื่อมต่อ

**วิธีที่สง่างามในการยุติการเชื่อมต่อคือการใช้ฟิลด์ FIN ตามด้วย ACK**
- ในกรณีนี้ ลูกค้าหรือเซิร์ฟเวอร์จะส่งเซ็กเมนต์ TCP ที่มีบิต FIN ตั้งค่า
- โฮสต์ที่รับจะ ACK FIN
- กระบวนการนี้ปิดการเชื่อมต่อครึ่งหนึ่ง - ต้องทำซ้ำโดยโฮสต์ที่รับ

**วิธีการปิดการเชื่อมต่อ TCP อย่างกะทันหันคือการส่งเซ็กเมนต์ RST (Reset)**
- จะยุติการเชื่อมต่อ TCP และไม่มีการสื่อสารเพิ่มเติมระหว่างโฮสต์

## หมายเลขลำดับใน TCP

**หมายเลขลำดับและหมายเลขการยืนยันมีความสำคัญมากใน TCP สำหรับการส่งข้อมูลที่เชื่อถือได้**
- หมายเลขลำดับของ TCP Segment บอกผู้รับว่ามีข้อมูลกี่ไบต์ที่ถูกส่ง
  - ตัวอย่าง: เซ็กเมนต์ TCP แรกส่งข้อมูล 1000 ไบต์และหมายเลขลำดับคือ 235, เซ็กเมนต์ TCP ถัดไปจะมีหมายเลขลำดับ 1235
- หมายเลขการยืนยันบอกผู้รับว่าหมายเลขไบต์ถัดไปที่คาดหวังคืออะไร
  - ตัวอย่าง: เซิร์ฟเวอร์รับข้อมูล 1000 ไบต์จาก TCP Segment ที่มีหมายเลขลำดับ 235 - มันได้รับไบต์ที่หมายเลข 235 ถึง 1234 ดังนั้นมันจึงตั้งค่าหมายเลขการยืนยันเป็น 1235

## ICMP

**Internet Control Message Protocol (ICMP)**

- ICMP เป็นโปรโตคอลที่ค่อนข้างต่ำในลำดับชั้นของโปรโตคอล ใช้สำหรับตอบกลับคำขอที่ง่ายๆ
- อยู่ใต้ชั้นการขนส่ง (Transport Layer) และเหนือชั้น IP (IP Layer) ของสแต็กโปรโตคอล
- ไม่มีหมายเลขพอร์ตใดๆ - แต่มีประเภท (Types) และรหัส (Codes) อยู่ในสองไบต์แรกของหัว (Header)
- ไม่มีแนวคิดของลูกค้า (Client) หรือเซิร์ฟเวอร์ (Server) - ผลกระทบส่วนใหญ่จะเป็นภายในโฮสต์ที่รับ
- ไม่มีการรับประกันการจัดส่ง
  - โฮสต์ไม่จำเป็นต้องรับฟัง ICMP ข้อความ
  - ICMP ข้อความสามารถถูกกระจาย (Broadcast) ไปยังโฮสต์
- อาจเป็นแหล่งของการรั่วไหลของข้อมูล - เช่น โฮสต์ไม่สามารถเข้าถึงได้

## ICMP Codes and Types

**ICMP มีไบต์แรก 8 ไบต์ของหัว IP ที่ก่อให้เกิดการตอบกลับ ICMP**

- **Ping** ส่ง ICMP (8,0) และรับ ICMP (0,0)
- **Traceroute** ใช้ ICMP
  - ส่ง ICMP ที่มี TTL = 1, 2, 3, 4 ... ไปยังปลายทาง
  - แต่ละเราเตอร์ตามเส้นทางจะตรวจพบ TTL ว่าได้หมดอายุแล้วและตอบกลับด้วย ICMP (11,0) ซึ่งช่วยให้ Traceroute สามารถกำหนดเส้นทางได้

**ประเภทและรหัส ICMP**
| **Type** | **Code** | **Remark** |
|----------|----------|------------|
| 0        | 0        | Echo reply (ping) |
| 3        | 0        | Destination Network Unreachable |
| 3        | 1        | Destination Host Unreachable |
| 3        | 3        | Destination Port Unreachable |
| 8        | 0        | Echo request |
| 9        | 0        | Router advertisement |
| 11       | 0        | TTL Expired |
| 12       | 0        | IP Header Bad |

## Legitimate ICMP Activity

- **Routers** ส่งข้อความ “host unreachable”
  - พบได้บ่อยเมื่อโฮสต์ปิดเครื่องเพื่อการบำรุงรักษาหรือเหตุผลอื่น
  - สามารถใช้ในการรวบรวมข้อมูลในกระบวนการสืบค้น (Reconnaissance)
- **Port Unreachable**
  - ICMP สามารถใช้เพื่อตรวจสอบว่าพอร์ต UDP เปิดอยู่หรือไม่
  - พอร์ต TCP ตอบกลับด้วยธง RST/ACK
- บางครั้ง **Router** แจ้งว่าการรับส่งข้อมูล ICMP ถูกบล็อก!
- **Router redirect messages**
  - แจ้งโฮสต์เกี่ยวกับเราเตอร์ที่เหมาะสมกว่า
- จำเป็นต้องแบ่งแพ็กเกจเนื่องจาก MTU ถูกเกิน
- TTL หมดอายุ (เวลาเกินในระหว่างการขนส่ง)

## DNS

**Domain Name System**

- **DNS** แปลงชื่อโฮสต์เป็นที่อยู่ IP และในทางกลับกัน
  - ต้นไม้สำหรับการสอบถามข้างหน้า – ที่อยู่ IP ของ www.kmutnb.ac.th คืออะไร?
  - ต้นไม้สำหรับการสอบถามย้อนกลับ – ชื่อโฮสต์ของ 136.142.116.28 คืออะไร?
- การใช้งานทั่วไปคือ **bind**
- DNS เก็บที่เรียกว่า **resource records (RRs)**
  - สามารถเปิดเผยข้อมูลมากมายเกี่ยวกับโฮสต์และที่อยู่

## DNS vs Typical Client-Server

**การโต้ตอบของลูกค้า-เซิร์ฟเวอร์แบบทั่วไป**

- ลูกค้าขอเชื่อมต่อกับเซิร์ฟเวอร์
- เซิร์ฟเวอร์ตอบสนอง - การจับมือ (Handshakes) เกิดขึ้น
- การเริ่มต้นเซสชันมีการโต้ตอบระหว่างสองเอนทิตีเท่านั้น

**DNS แตกต่างออกไป**

- ลูกค้าส่งคำขอ DNS ไปยังเซิร์ฟเวอร์
- เซิร์ฟเวอร์รับคำขอ – อาจติดต่อเซิร์ฟเวอร์ DNS อื่น
- เมื่อได้รับข้อมูลแล้ว เซิร์ฟเวอร์จะส่งคืนข้อมูลนั้นให้กับลูกค้า

## DNS Details

- หลายโปรโตคอลใช้ DNS ในการแปลชื่อที่ลูกค้าให้เป็นที่อยู่ IP
  - DNS ต้องถูกเรียกใช้โดย http, ftp, smtp ฯลฯ
  - DNS อาจเพิ่มความล่าช้าในกระบวนการสื่อสาร
- DNS เป็นโปรโตคอลระดับแอปพลิเคชัน แต่โดยทั่วไปไม่ถูกใช้โดยตรงจากผู้ใช้
- คำขอและการตอบสนอง DNS ใช้พอร์ต 53 ผ่าน UDP
  - TCP ใช้สำหรับการถ่ายโซน (Zone Transfers)

## Other DNS Services

นอกเหนือจากการแมปที่อยู่แล้ว DNS ยังให้บริการ:

- **Host Aliasing** (เช่น www.kmutnb.ac.th สามารถมีสองชื่อแทน – kmutnb.ac.th และ web.kmutnb.ac.th)
- **Mail Server Aliasing** (เช่น phongsakk@kmutnb.ac.th ต้องไปที่ mail.kmutnb.ac.th)
- **Load Distribution** (เช่น หลายเว็บไซต์ใช้เว็บเซิร์ฟเวอร์ที่ทำซ้ำซึ่งแต่ละตัวทำงานบนโฮสต์เอนด์ระบบที่แตกต่างกัน)
  - DNS ตอบกลับด้วยชุดของโฮสต์ทั้งหมด แต่สลับลำดับเป็นระยะ

## Resource Records

**Resource Records (RRs)** เก็บการแมพชื่อโฮสต์ไปยังที่อยู่ IP

- แต่ละ RR มีสี่ฟิลด์
  - [Name, Value, Type, TTL]
  - มีหลายประเภท
  - **TTL** ระบุระยะเวลาที่ RR ใช้ได้

## Name Servers

**Local Name Servers**

- แต่ละ ISP มีเซิร์ฟเวอร์ชื่อของตัวเอง – เครื่องทั้งหมดในท้องถิ่นติดต่อเซิร์ฟเวอร์ชื่อในท้องถิ่นก่อน
  - การแปลในท้องถิ่นรวดเร็ว ง่ายและง่ายต่อการนำไปใช้

**Root Name Servers**

- จำนวนที่นับได้ทั่วโลก (13)
  - เซิร์ฟเวอร์ท้องถิ่นติดต่อเซิร์ฟเวอร์รูทหากไม่สามารถแก้ไขชื่อได้

**Authoritative Name Servers**

- เซิร์ฟเวอร์รูทแนะนำเซิร์ฟเวอร์ท้องถิ่นไปยังเซิร์ฟเวอร์ชื่อที่มีข้อมูลที่เกี่ยวข้องกับโฮสต์
  - รักษาข้อมูลที่มีอำนาจสำหรับโซน

## Zone Transfers

**Zone**

- **Name spaces** ถูกแบ่งออกเป็นโซนตามการแยก "จุด" ในชื่อ
  - ตัวอย่าง: kmutnb.ac.th เป็นโซน
- แต่ละโซนรักษาเซิร์ฟเวอร์ชื่อหลักและรอง
  - เซิร์ฟเวอร์รองจะตรวจสอบเซิร์ฟเวอร์หลักเป็นระยะเพื่อรับข้อมูลโซน
  - หากข้อมูลมีการเปลี่ยนแปลง จะเริ่มการถ่ายโซนที่ดาวน์โหลดฐานข้อมูลทั้งหมด

## Recursive Queries

- เซิร์ฟเวอร์ท้องถิ่นไม่ทราบที่อยู่ IP ของโฮสต์
  - ติดต่อเซิร์ฟเวอร์รูท
  - เซิร์ฟเวอร์รูทก็ไม่ทราบที่อยู่ IP
    - ติดต่อเซิร์ฟเวอร์ชื่อที่มีอำนาจซึ่งส่งกลับที่อยู่
  - เซิร์ฟเวอร์รูทส่งที่อยู่กลับไปยังเซิร์ฟเวอร์ท้องถิ่น
  - เซิร์ฟเวอร์ท้องถิ่นส่งที่อยู่ IP ไปยังโฮสต์ที่ร้องขอ
- อาจมีการใช้เซิร์ฟเวอร์กลาง
![alt text](/Lecture-2/img/recursive.png)

## Iterative Queries

- หากเซิร์ฟเวอร์ใด ๆ ไม่ทราบที่อยู่ IP มันอาจส่งที่อยู่ของเซิร์ฟเวอร์ถัดไปในรายการให้กับโฮสต์ที่ร้องขอ
  - โฮสต์ที่ร้องขอจะทำการร้องขอโดยตรงไปยังเซิร์ฟเวอร์ชื่อใหม่
- โดยทั่วไปคำร้องขอส่วนใหญ่เป็นแบบเรียกซ้ำ (recursive) ยกเว้นเมื่อทำการร้องขอไปยังเซิร์ฟเวอร์รูท
  - การค้นหาคำถามเป็นการผสมผสานระหว่างการค้นหาแบบเรียกซ้ำและแบบเชิงซ้อน (iterative)

    ![alt text](/Lecture-2/img/iterative.png)

## Inverse Lookup

- การค้นหากลับ (inverse look-ups) จะดำเนินการในลักษณะที่แตกต่างออกไปโดยเซิร์ฟเวอร์ DNS
  - ตัวอย่าง: ค้นหา 136.142.116.28
    - คำถามจะถูกแก้ไขเป็น 28.116.142.136.in-addr.arpa
    - ความคล้ายคลึงกันระหว่างการค้นหาแบบตรงและกลับ
      - โดเมนระดับสูงสุด "arpa" มีเพียงหนึ่งซับโดเมน "in-addr"
      - ที่อยู่โฮสต์ (เช่น 28) มาแรกเหมือนกับการค้นหาแบบตรง

- ต้นไม้กลับ (inverse trees) มักจะไม่เป็นปัจจุบันและอาจนำไปสู่ปัญหาด้านความปลอดภัย

## DNS Software

**Berkeley Internet Name Domain (BIND)**

- การใช้งานที่พบบ่อยที่สุดเรียกว่า `named`
  - มีหลายเวอร์ชัน (เวอร์ชันล่าสุดคือ 9.3.y)

**ATLAS**

- Advanced Translation Look-up And Signaling
  - ซอฟต์แวร์ DNS ที่เป็นกรรมสิทธิ์ของ Verisign

**Microsoft**

- มีซอฟต์แวร์ DNS ของตนเองตั้งแต่ Win2K

**djbdns**

- ซอฟต์แวร์ DNS ฟรี
  - ดูที่ www.tinydns.org

## The Security Breach Process

**Phases**

- Reconnaissance
- Exploitation
- Reinforcement
- Consolidation
- Pillage

ความซับซ้อนและความอ่อนแอของเครือข่ายและโปรโตคอลช่วยในการทำให้กระบวนการนี้ง่ายขึ้น

## Classes of Attacks
![alt text](/Lecture-2/img/classofattacks.png)

### Process and Attacks - 1

**Reconnaissance**

- ใช้การ “รั่วไหลของข้อมูล” (Information Leakage) อย่างกว้างขวาง
  - การรั่วไหลแบบพาสซีฟ (Passive) และแบบแอคทีฟ (Active) เป็นไปได้
    - การตรวจสอบแบบพาสซีฟ (Passive reconnaissance) ยากที่จะตรวจจับ
      - ตัวอย่าง: การค้นหาใน Google
    - การตรวจสอบแบบแอคทีฟ (Active reconnaissance) อาจดูเหมือน “ปกติ”
      - ใช้โปรโตคอลตามที่ควรจะใช้
- กลยุทธ์การตรวจสอบอื่น ๆ อาจเห็นได้ชัด
  - การสแกนพอร์ต (Port scanning), การกระจายการส่งข้อมูลไปยังทิศทางที่กำหนด (Directed broadcast) และอื่น ๆ



**Exploitation, Reinforcement and Consolidation**

- ใช้รหัสผ่านที่ถูกขโมย (Stolen passwords), ความล้มเหลวในการตรวจสอบสิทธิ์ (Authentication failures), วิศวกรรมสังคม (Social engineering) และข้อบกพร่อง (Bugs) และช่องโหว่ (Backdoors)
- สามารถใช้เทคนิคผสมผสานกันได้
  - ข้อบกพร่อง (Bugs) ยากที่จะป้องกัน
  - ขั้นตอนและการฝึกอบรมสามารถช่วยป้องกันการโจมตีทางวิศวกรรมสังคม
  - มาตรการรักษาความปลอดภัยสามารถป้องกันการขโมยรหัสผ่านและความล้มเหลวในการตรวจสอบสิทธิ์

**Pillage**

- ตัวอย่างที่ดีคือ การโจมตีแบบปฏิเสธบริการ (Denial of Service Attacks)
- เราจะพิจารณาเรื่องนี้ในภายหลัง
<br><br><br>

# Stealing Passwords
**แพ็กเก็ตที่ไหลบนไฟล์เครือข่ายที่จัดเก็บบนโฮสต์ที่สามารถเข้าถึงได้ผ่านเครือข่าย**

## Stealing Passwords

**Special Case of Information Leakage**

- การขโมยรหัสผ่านเป็นกรณีพิเศษของการรั่วไหลของข้อมูล
- มีผลกระทบที่ใหญ่กว่าต่อความปลอดภัย
- หากรหัสผ่านถูกขโมย, Oscar สามารถทำได้มากกว่าการเข้าถึงข้อมูลเพียงอย่างเดียว
  - Oscar สามารถเปลี่ยนจากการเป็นบุคคลภายนอกไปเป็นผู้ใช้ที่ได้รับการอนุญาตแล้ว ไปจนถึงการเป็นผู้ดูแลระบบในหลายขั้นตอน - การเสริมและการรวมกลุ่ม
- การโจมตีที่ยากที่จะตรวจจับเพราะ Oscar ดูเหมือนเป็นผู้ใช้ที่ถูกต้องตามกฎหมาย
- มีหลายวิธีที่รหัสผ่านอาจถูกขโมย

## How Passwords Can Be Stolen

**Password in Cleartext**

- รหัสผ่านและการเข้าสู่ระบบถูกส่งในรูปแบบข้อความธรรมดาโดยบางโปรโตคอล
- มีเครื่องมือแคร็กเกอร์หลายตัวที่สามารถดักจับแพ็กเก็ตและดึงรหัสผ่านได้
- การโจมตีด้วยดิกชันนารี
  - การเข้าถึงไฟล์รหัสผ่านที่ถูกแฮช (การรั่วไหลของข้อมูล)
  - ผู้ใช้มักเลือกใช้รหัสผ่านที่มีจำนวนจำกัด – ไม่ใช่รหัสผ่านสุ่ม 280 ตัวเลือก
  - ง่ายต่อการแตกด้วยเทคโนโลยีปัจจุบัน
- การโจมตีอื่น ๆ
  - JavaScript ที่สร้างขึ้นสามารถหลอกลวงผู้ใช้ให้เปิดเผยรหัสผ่าน
  - การโจมตีทางสังคมอื่น ๆ

## Passwords in Cleartext

**Several Protocols Transmit Passwords in Cleartext**

- โปรโตคอลหลายตัวส่งรหัสผ่านในรูปแบบข้อความธรรมดา
  - Telnet
  - POP (เวอร์ชันเก่า)
  - การตรวจสอบพื้นฐานที่ดำเนินการโดยเว็บเซิร์ฟเวอร์
  - SNMPv1
- มีเครื่องมือที่สามารถดักจับแพ็กเก็ตเหล่านี้และกู้คืนรหัสผ่าน
  - ง่ายต่อการใช้งานและไม่ต้องการความรู้เกี่ยวกับเครือข่าย, โปรโตคอล หรือการเขียนโปรแกรม

## Dictionary Attacks

**How Can Oscar Get Access to a Hashed Password?**

- **Revealed /etc/passwd Files**
  - TFTP, SMB, NIS
  - Compromised hosts
  - Keys of SSH may also be attacked this way

- **Hashed Password on the Physical Medium**
  - POPv3
  - Digest authentication by web servers

**Password Guessing and Dictionary Attacks**

- Given access to a password file (encrypted), Oscar tests each password to see if there is a match
  - Easy to do since the hash function is known
  - To improve the probability of success, Oscar tries common words, proper names, lowercase strings, etc. – dictionary attacks
  - He can use information obtained through leakage to improve his attack!

<br>

# Authentication Failures
**การโจมตีแบบปลอมแปลง (SPOOFING ATTACKS)**
## การล้มเหลวในการพิสูจน์ตัวตน

**ความหมายโดยทั่วไป**

- กลไกในการตรวจสอบว่าแหล่งที่มาของคำขอหรือคำสั่งเป็นของแท้ล้มเหลวในการหยุด Oscar

**ตัวอย่างทั่วไป**

- **SMTP**
  - คุณเชื่อว่าอีเมลมาจากบุคคลที่แสดงในฟิลด์ "From" ของอีเมล
  - คุณไม่สามารถเชื่อถือสิ่งนี้ได้จริงๆ

- **คำสั่ง “r”**
  - คำสั่งอย่าง `rlogin`, `rsh` ขึ้นอยู่กับที่อยู่แหล่งของโฮสต์ที่ขอ + การยืนยันชื่อผู้ใช้เป็นการตรวจสอบความถูกต้อง

- **โปรโตคอลการพิสูจน์ตัวตนแบบเข้ารหัส**
  - เป็นสิ่งที่จำเป็นแต่โดยปกติไม่ถูกใช้งาน

## การปลอมแปลงที่อยู่ IP

**ที่อยู่ IP**

- ใน IPv4, ที่อยู่ IP แหล่งและปลายทางมีความยาว 32 บิต
  - 32 บิตถูกแบ่งออกเป็นสองส่วน:
    - ส่วนของเครือข่ายและส่วนของโฮสต์
  - ปัจจุบันผู้คนใช้การกำหนดเส้นทางระหว่างโดเมนที่ไม่มีคลาส (CIDR)
    - ตัวอย่าง: `136.142.116.28/24` หมายถึง 24 บิตแรกเป็นฟิลด์ของเครือข่าย

**ที่อยู่ IP เป็นตัวระบุ**

- บริการและเครื่องมือจำนวนมากใช้ที่อยู่ IP แหล่งสำหรับการพิสูจน์ตัวตน
- หากที่อยู่ IP แหล่งมีความถูกต้อง, เชื่อถือแพ็กเก็ตและคำขอ!
- คุณไม่สามารถพึ่งพาความถูกต้องของที่อยู่ IP แหล่งนอกจากในสถานการณ์ที่ควบคุมได้อย่างเข้มงวด

## การปลอมแปลง ARP

**ARP = Address Resolution Protocol**

- ชั้นลิงก์/MAC ไม่เข้าใจที่อยู่ IP
- NIC สามารถรู้จักเฉพาะที่อยู่ MAC
- ARP ใช้เพื่อจับคู่ที่อยู่ MAC กับที่อยู่ IP
- แพ็กเก็ต ARP เป็นแพ็กเก็ตที่ออกอากาศ (บน LAN เช่น)

**ผลกระทบ**

- หาก Oscar สามารถเขียนไปที่เครือข่ายท้องถิ่น, เขาสามารถ:
  - ส่งคำขอหรือการตอบกลับ ARP ที่เป็นเท็จ
- **ผลกระทบ**
  - Oscar สามารถเบี่ยงเบนการจราจรไปยังตนเองและแก้ไขข้อมูลก่อนส่งไปยังปลายทาง

**หมายเหตุ**

- เครื่องมือแฮ็กเกอร์ที่ใช้ในการปลอมแปลง ARP มีอยู่
- ใน IPv6, จะใช้โปรโตคอล “การค้นพบเพื่อนบ้าน” หรือ ND แทน ARP และอาจสร้างปัญหาที่รุนแรงมากขึ้นหากถูกปลอมแปลง

## TCP และ UDP

**TCP**

- ไม่สามารถเชื่อถือหมายเลขพอร์ตที่มีสิทธิ์จาก TCP:
  - ใน UNIX และระบบปฏิบัติการที่คล้าย UNIX, หมายเลขพอร์ตต่ำกว่า 1024 เป็น “มีสิทธิ์” – เพียง “root” เท่านั้นที่สามารถเข้าถึงหมายเลขเหล่านี้
  - นี่ไม่มีความหมายสำหรับระบบปฏิบัติการอื่นๆ
  - ง่ายต่อการปลอมแปลงหมายเลขพอร์ตในแพ็กเก็ตที่สร้างขึ้นโดยเฉพาะ

**UDP**

- หมายเลขลำดับ UDP สามารถปลอมแปลงได้ง่าย:
  - เนื่องจากไม่มีการจับมือกับ UDP, การปลอมแปลง UDP จึงง่ายกว่า
  - UDP รองรับบริการหลายอย่าง (เช่น DNS) และอาจเป็นอันตราย

## DNS และการล้มเหลวในการพิสูจน์ตัวตน

**การค้นหาย้อนกลับ DNS**

- ใช้ในการพิสูจน์ตัวตนของคำสั่ง “r”
  - หาก Oscar ควบคุมต้นไม้การค้นหาย้อนกลับได้, เขาสามารถปลอมแปลงได้
  - ระเบียนย้อนกลับจะมีชื่อของเครื่องที่เครื่องของคุณเชื่อถือ

**การค้นหา DNS ใหม่**

- ดำเนินการค้นหาทั้งสองทางเพื่อป้องกันการโจมตีดังกล่าว
  - การตรวจสอบข้ามจะดำเนินการโดย `gethostbyaddr`
  - หากตรวจพบความผิดปกติ, ควรถูกบันทึก

## DHCP/BOOTP

**DHCP = Dynamic Host Configuration Protocol**

- ใช้ในการมอบหมายที่อยู่ IP
- ให้ข้อมูลเกี่ยวกับเซิร์ฟเวอร์ชื่อ, เกตเวย์ ฯลฯ
- ลูกค้าส่งคำขอ UDP ที่ออกอากาศ
- เซิร์ฟเวอร์ตอบกลับด้วยข้อมูล
- สามารถเชื่อมต่อกับเซิร์ฟเวอร์ชื่อเพื่อเปิดใช้งานการจับคู่ชื่อกับที่อยู่ IP

**หมายเหตุ**

- สามารถให้ข้อมูลจำนวนมาก
- บันทึกมีความสำคัญสำหรับการตรวจสอบ
- ใช้เฉพาะในเครือข่ายท้องถิ่น:
  - จำเป็นต้องรู้ที่อยู่ MAC ของลูกค้า
  - ลดความเสี่ยง, แต่ข้อความที่ปลอมแปลงอาจเบี่ยงเบนการจราจร
  - ง่ายต่อการปลอมแปลง ARP และบรรลุวัตถุประสงค์เดียวกัน

## คุกกี้และอื่นๆ

**HTTP เป็น Stateless**

- การร้องขอและการตอบกลับ HTTP แต่ละรายการจะถูกพิจารณาเป็นการแยกต่างหาก
- ยากสำหรับเซิร์ฟเวอร์เว็บในการกำหนดสถานะของพวกเขากับลูกค้าที่พวกเขากำลังให้บริการ

**คุกกี้**

- รักษาข้อมูลสถานะสำหรับเซิร์ฟเวอร์
- บางครั้งฟิลด์ข้อมูลที่ซ่อนหรือฟิลด์พิเศษใน URLs ถูกใช้เพื่อรักษาสถานะ
- เซิร์ฟเวอร์บางแห่งพึ่งพาคุกกี้สำหรับการพิสูจน์ตัวตน

**ความกังวลด้านความปลอดภัย**

- คุกกี้สามารถปลอมแปลงได้ง่าย:
  - ผู้ใช้สามารถเปลี่ยนคุกกี้
  - เซิร์ฟเวอร์สามารถเข้ารหัสคุกกี้, แต่ก็ยังเสี่ยงต่อการโจมตีอื่นๆ (เช่น การเปลี่ยนคุกกี้)

## การล้มเหลวในการพิสูจน์ตัวตนอื่นๆ

**RPC และ RPCBind**

- ง่ายต่อการปลอมแปลง `userid`, `groupid`, `machine name`, ฯลฯ
- **RPCbind**
  - อันตรายมากขึ้นเนื่องจากคุณสามารถขอให้ RPCbind ส่งคำขอทางอ้อมไปยังบริการ
- **วิธีแก้ไข**
  - ใช้เวอร์ชัน RPC ที่ได้รับการปกป้องโดย Kerberos

**NTP – Network Time Protocol**

- โทเค็นการพิสูจน์ตัวตนบางตัวออกแบบมาให้หมดอายุหลังจาก “ช่วงเวลา”
  - ตัวอย่าง: Kerberos
- โทเค็นสามารถปลอมแปลงเพื่ออนุญาตการเล่นซ้ำของโทเค็นการพิสูจน์ตัวตน

## ข้อบกพร่องและช่องโหว่

**การล้นของบัฟเฟอร์**

- การล้นของบัฟเฟอร์เป็นปัญหาที่ใหญ่ที่สุดในการสร้างข้อบกพร่องและช่องโหว่
  - ตัวอย่าง: finger daemon และ Internet Worm

**โปรโตคอลที่มีข้อบกพร่อง**

- Sendmail
- RPC
- NFS
- FTP

**การกำหนดค่าผิดพลาด**

- FTP daemon
- เว็บไซต์ FTP ที่อนุญาต
- ตัวอย่าง: Java FTP client

## ข้อบกพร่องและช่องโหว่ - II

**วิธีอื่นๆ ที่ไม่ชัดเจนในการใช้ช่องโหว่**

- **เอกสารที่ส่งกลับจาก HTTP**
  - อาจขอให้โปรแกรมเฉพาะประมวลผล

- **Spyware, Adware, Foistware**
  - ไม่มีการแก้ไข

- **ActiveX**
  - หากโค้ดได้รับการเซ็นชื่อ, สามารถเชื่อถือได้!

- **เบราว์เซอร์ที่รองรับการเข้ารหัสที่อ่อนแอ**

- **สคริปต์เซิร์ฟเวอร์ที่เขียนไม่ดี**
  - ให้จุดเข้าถึงสำหรับ Oscar ในการแทรกโค้ดที่เป็นอันตราย

## การวิศวกรรมสังคม

**อ่านหนังสือของ Kevin Mitnick “The Art of Deception”**

- อีเมล, URLs, และ JavaScripts
- การฟิชชิงและการฟาร์มมิ่ง
- ความไม่รู้และความเรียบง่าย
- ความประมาท
- FIS แนะนำให้มีพฤติกรรมเกือบถึงระดับการควบคุม
