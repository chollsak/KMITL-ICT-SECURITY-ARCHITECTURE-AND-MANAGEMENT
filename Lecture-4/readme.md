***Lecture 4: SECURITY ASSESSMENT การประเมิน***

<br>

# Information Leakage
**HOW PROTOCOLS CAN REVEAL INFORMATION TO ATTACKES**

## การรั่วไหลของข้อมูล (Information Leakage)

### ข้อมูลที่อาจรั่วไหล

- **โปรโตคอลสามารถเปิดเผยข้อมูล**: บางโปรโตคอลออกแบบมาเพื่อให้ข้อมูล เช่น ข้อมูลที่เปิดเผยโดยการออกแบบอาจเปิดเผยข้อมูลมากขึ้นให้กับผู้โจมตี
- **การใช้ข้อมูลที่รั่วไหล**:
  - การโจมตีโดยการทำสังคม (Social Engineering)
  - การแตกพาสเวิร์ด (Cracking Passwords)
  - การสร้างแผนที่โครงสร้างเครือข่าย (Mapping Network Topologies)
  - การระบุบริการที่เปิดอยู่จากเซิร์ฟเวอร์ (Determining Open Services Provided by Servers)

### ข้อมูลไม่ควรถูกมองว่าเป็นเรื่องธรรมดา

- ข้อมูลทั้งหมดสามารถถูกใช้ในทางที่ผิดได้

## การรั่วไหลของข้อมูลเกิดขึ้นได้อย่างไร?

### การรั่วไหลแบบพาสซีฟ (Passive)

- **การดักจับสาย (Wire(less)tapping)**:
  - การเข้าถึงสื่อกลางทางกายภาพของการสื่อสาร
  - การโจมตีเชิงรุกที่อาจเกิดขึ้น - การเปลี่ยนเส้นทางไปยังสื่อกลางทางกายภาพที่แตกต่าง
- **Tempest**:
  - การปล่อยสัญญาณอิเล็กทรอนิกส์ที่สามารถถูกจับโดยผู้โจมตี

### การรั่วไหลแบบเชิงรุก (Active)

- **บริการข้อมูล (Information Services)**:
  - โปรโตคอลที่ออกแบบมาเพื่อให้ข้อมูล
- **โปรโตคอลที่ไม่ปลอดภัย (Insecure Protocols)**:
  - โปรโตคอลทั่วไปที่เปิดเผยข้อมูลโดยไม่ตั้งใจ
  - โปรโตคอลที่สามารถถูกใช้เพื่อรับข้อมูล

## ตำแหน่งสำหรับการดักจับสาย (Wiretapping)

- **ภายใน (Internal)**:
  - ห้องที่มีสายไฟ (Wiring Closets)
  - ลิงก์กระจาย (Broadcast Links) (LANs)
  - Tempest
- **ภายนอก (External)**:
  - โมเด็มดิสคอนเน็กต์, เราเตอร์, ลิงก์ไมโครเวฟ
  - การดักจับการเดินสายทองแดงและสัญญาณไร้สายง่ายกว่าฟิเบอร์
  - การดักจับฟิเบอร์กำลังเป็นเรื่องง่ายขึ้น
  - สัญญาณ WLAN สามารถตรวจจับได้จากระยะทางไกลโดยใช้เสาอากาศที่มีความแรงสูง

## การดักจับจุดภายนอก (Tapping into External Points)

- **แนวคิด**:
  - ปลอมแปลงเส้นทางเพื่อให้แพ็กเก็ตเดินทางผ่านเราเตอร์/โฮสต์ที่ควบคุมโดยผู้โจมตี
- **วิธีการ**:
  - ใช้ ICMP ส่งข้อความเปลี่ยนเส้นทางเท็จไปยังเราเตอร์
  - ตัวเลือกเส้นทางต้นทางที่หลวมของ IP (IP Loose Source Route Option)
  - ข้อความเส้นทางปลอม (Bogus Routing Messages)

### การใช้ ICMP

- ข้อความเปลี่ยนเส้นทาง ICMP สามารถใช้เพื่อสร้างเส้นทางทางเลือกไปยังปลายทาง
  - ผู้โจมตีสามารถใช้วิธีนี้เพื่อเปลี่ยนเส้นทางการจราจรผ่านเครื่องที่เขาควบคุม
  - เขาสามารถเปลี่ยนแปลง, ดักจับ, หยุดแพ็กเก็ตได้
- **การป้องกัน**:
  - ข้อความเปลี่ยนเส้นทาง ICMP ควรจะถูกปฏิบัติตามโดย "โฮสต์" เท่านั้น ไม่ใช่เราเตอร์
  - ควรปฏิบัติตามเฉพาะเมื่อส่งโดยเราเตอร์ในเครือข่ายเดียวกับโฮสต์

### การใช้ตัวเลือกเส้นทางต้นทางที่หลวมของ IP (IP Loose Source Route Option)

- ผู้เริ่มต้นการเชื่อมต่อสามารถระบุเส้นทางที่ต้องการให้การตอบกลับไป
  - นี่เป็นเส้นทางที่ชัดเจนที่แพ็กเก็ตต้องใช้เพื่อไปยังปลายทาง
  - จุดหมายปลายทางจะใช้เส้นทางย้อนกลับเป็นเส้นทางกลับไม่ว่าในกรณีใด
- ผู้โจมตีสามารถปลอมแปลงที่อยู่ต้นทางและทำให้แพ็กเก็ตเดินทางผ่านเราเตอร์หรือโฮสต์ของเขา

### ข้อความ RIP หรือ BGP ปลอม (Bogus RIP or BGP Messages)

- **RIP (Routing Information Protocol)**:
  - ใช้ในการแลกเปลี่ยนข้อมูลเส้นทางใน Autonomous System (AS)
  - การแลกเปลี่ยนตารางเส้นทางทุก 30 วินาที
  - ในเวอร์ชันที่เก่า การฉีดข้อความเส้นทางเท็จเป็นเรื่องง่าย
- **BGP (Border Gateway Protocol)**:
  - กระจายข้อมูลเส้นทางระหว่าง ASs
  - เสี่ยงต่อการโจมตีคล้ายกัน
  - เป็นอันตรายมากขึ้นเนื่องจากใช้เวลาประมาณ 20 นาทีในการแพร่กระจายข้อมูล BGP ผ่านอินเทอร์เน็ต

## การป้องกันการดักจับสาย (Protection Against Wiretapping)

- การป้องกันทางกายภาพของตู้สายไฟ, โฮสต์, เราเตอร์ ฯลฯ
- **OSPF และ RIPv2** รองรับการตรวจสอบสิทธิ์บางประการ
  - ส่วนใหญ่การตรวจสอบสิทธิ์มีความอ่อนแอ
  - เช่น การตรวจสอบสิทธิ์ที่ใช้รหัสผ่านที่ง่ายและชัดเจน
- หากเราเตอร์ถูกบุกรุก ก็ไม่มีความหมาย
- ตรวจสอบโครงสร้างเครือข่ายเพื่อดูว่าเส้นทางที่โฆษณานั้นสมเหตุสมผล
  - ยากที่จะดำเนินการ
- ผู้ให้บริการอินเทอร์เน็ตใช้โปรโตคอล IS-IS ภายใน
  - **IS = Intermediate System** (จากโมเดล OSI)
  - เนื่องจากโปรโตคอลนี้ไม่เป็นที่รู้จักมากนัก จึงมีการป้องกันบางประการ
- ใช้การเข้ารหัส (Encryption)

## Tempest

### การรั่วไหลของข้อมูล (TEMPEST)

- **การปล่อยรังสีและการแผ่กระจายจากอุปกรณ์**:
  - หากมีข้อมูลที่ละเอียดอ่อนอาจถูกทำลาย
  - ตัวอย่างการปล่อยรังสีที่รั่วไหล:
    - จอภาพ (Van Eck Radiation)
    - การกดแป้นพิมพ์
    - การอ่านและเขียนข้อมูลบนดิสก์
  - การรั่วไหลข้ามสายที่บรรทุกข้อมูลที่ได้รับการจัดประเภทและไม่ได้จัดประเภท

### การป้องกันภัยคุกคาม Tempest

- **การจำแนกประเภท**:
  - **แดง (Red)**: สายเคเบิลและอุปกรณ์ที่บรรทุกข้อมูลที่ได้รับการจัดประเภท
  - **ดำ (Black)**: สายเคเบิลและอุปกรณ์ที่บรรทุกข้อมูลที่ไม่ได้จัดประเภท
- **การแยกประเภท Red/Black อย่างเข้มงวด**:
  - ต้องแยกพื้นที่ทางกายภาพ
- **การออกแบบวงจรและการต่อกราวด์อย่างรอบคอบ**
- **การใช้อุปกรณ์ที่สอดคล้องกับมาตรฐานของรัฐบาล/ทหาร**:
  - เช่น MIL-STD-461B

## ข้อมูลบริการ (Information Services)

### บริการข้อมูลที่มีอยู่

- **DNS**
- **NIS**
- **Finger, whois, LDAP, และเว็บ**

### การให้ข้อมูลเกี่ยวกับเครือข่ายและผู้ใช้

- **ใครที่ล็อกอินอยู่**
- **บัญชีที่ไม่ได้ใช้งานมานาน**
- **ที่อยู่ IP ที่ใช้**
- **ระบบปฏิบัติการที่กำลังทำงาน**

## เครื่องมือ DNS

### nslookup

- ใช้ได้ทั้งในระบบปฏิบัติการ Unix และ Windows
- **โหมดที่ไม่โต้ตอบและโหมดโต้ตอบ**
- ตัวเลือกในการเปลี่ยน nameserver, แก้ไขชื่อโฮสต์ด้วยเซิร์ฟเวอร์เฉพาะ ฯลฯ
- ใช้ `man nslookup` บนเครื่อง Unix หรือ `nslookup` และ `help` บนเครื่อง Windows สำหรับรายละเอียดเพิ่มเติม

    ![alt text](/Lecture-4/img/nslookup.png)

### dig

- ใช้หลักในระบบ Unix-like
- สามารถให้ข้อมูลมากมายตามตัวเลือกที่เลือก
- ใช้สำหรับการแก้ไขปัญหาด้วย
- ใช้ `man dig` บนเครื่อง Unix สำหรับรายละเอียดเพิ่มเติม

## การโจมตีการถ่ายโอนโซน DNS (DNS Zone Transfer Attacks)

- ใช้เพื่อการสืบค้นและการเก็บข้อมูลของ Oscar
  - ข้อมูล DNS ถูกออกแบบมาให้พร้อมใช้งานทั่วโลก
  - ใช้ `ls -d` กับ `nslookup` เพื่อแสดงบันทึกทั้งหมดสำหรับโดเมน
  - ข้อมูลเกี่ยวกับโฮสต์ (OS, เวอร์ชัน, สถาปัตยกรรม ฯลฯ) อาจรวมอยู่ด้วย
- ตัวเลือกนี้มักจะถูกปิดโดยผู้ดูแลระบบส่วนใหญ่ยกเว้นสำหรับเซิร์ฟเวอร์ชื่อรอง
- ใช้การตรวจสอบสิทธิ์ตามชื่อ/ที่อยู่

## บริการข้อมูลอื่น ๆ

### LDAP

- **Lightweight Directory Access Protocol**:
  - จัดหาความลับของคีย์สาธารณะ, สมุดที่อยู่, ปฏิทิน ฯลฯ

### เว็บ

- บางการใช้งานเก่าช่วยให้สามารถแสดงรายการไฟล์ทั้งหมดในไดเรกทอรีของผู้ใช้

### Finger และ whois

## โปรโตคอลที่รั่วไหลข้อมูล (I) - RPC

### RPC (Remote Procedure Call)

- การเรียกซับรูทีนไปยังเซิร์ฟเวอร์แบบโปร่งใส
- **rpcbind** หรือ **portmapper**:
  - ใช้เพื่อจับคู่บริการกับหมายเลขพอร์ต
- **rpcinfo** สามารถเปิดเผยบริการที่มีอยู่ที่หมายเลขพอร์ตใดโดยใช้โปรโตคอลอะไร

## NIS

- **Network Information Service**:
  - เคยเรียกว่า Yellow Pages
  - แอปพลิเคชันที่ใช้ RPC
  - แจกจ่ายข้อมูลหลากหลายจากฐานข้อมูลกลางไปยังลูกค้า/เซิร์ฟเวอร์อื่น ๆ
- ตัวอย่าง: ไฟล์รหัสผ่าน, ฐานข้อมูลคีย์สาธารณะและเอกชน
- การควบคุมการเข้าถึงมีไว้เพื่อป้องกันการเข้าถึงที่ไม่ได้รับอนุญาต

## โปรโตคอลที่รั่วไหลข้อมูล (II) - HTTP

### HTTP

- **HTTP sessions**:
  - คำสั่ง GET พร้อม URL
    - **User agent** – ระบุเบราว์เซอร์และ OS
    - **Referer** – หน้าที่คลิกลิงก์
    - **Accept** – รูปแบบข้อมูลที่ยอมรับ
    - **Cookie** – ข้อมูลที่ตั้งค่าโดยเซิร์ฟเวอร์เดียวกัน
- **Response**: คล้ายกับข้อความ GET

## โปรโตคอลที่รั่วไหลข้อมูล (III)

### SMTP

- **Simple Mail Transfer Protocol**:
  - โปรโตคอลหลักสำหรับการส่งอีเมล
  - ใช้เพื่อรับข้อมูลที่มีค่า

### Instant Messaging

- ข้อมูลเกี่ยวกับการล็อกอิน/ล็อกเอาต์ของเพื่อน

### SNMP

- ใช้ในการจัดการเครือข่าย
- MIBs สามารถเปิดเผยข้อมูลมากมาย

### X11 Servers

- สามารถใช้จับการกดแป้นพิมพ์ของผู้ใช้คนอื่น
- ควรบังคับให้ทำงานเฉพาะบนเครื่องท้องถิ่น

## ช่องโหว่ของข้อมูลที่ร้ายแรงอื่น ๆ

### Anonymous FTP และ TFTP

- ควรถูกจำกัดไว้ที่ไดเรกทอรีบางแห่ง

### SMB (Server Message Block) Protocol

- ใช้พอร์ต 135-139, 445
- สามารถเปิดเผยเนื้อหาของไฟล์และวาง backdoors

<br>

# Abusing Protocols to get Information
**TCP AND ICMP**

## Port Scanning

### การสแกนพอร์ต

- **การสแกนพอร์ตเปิด**:
  - การสแกนพอร์ตเปิดเป็นวิธีทั่วไปที่ Oscar ใช้ในการค้นหาบริการที่พร้อมให้ใช้เพื่อการโจมตี
  - การสแกนหลายประเภทอาจไม่ซ่อนการพยายามสแกนโฮสต์/ระบบ

- **ACK Scan**:
  - Oscar ส่ง TCP segments ที่มีฟิลด์ ACK ตั้งค่าไปยังพอร์ตบนโฮสต์ที่เขาคิดว่าเปิดอยู่
  - หากพอร์ตเปิด บริการจะตอบกลับด้วย RST เนื่องจากไม่มีการเชื่อมต่อ
  - Oscar จะรู้ว่าพอร์ตเปิดอยู่
  - หาก ACK bit ถูกตั้งค่า บางการกรองแพ็กเก็ตอาจอนุญาตให้แพ็กเก็ตเข้าสู่เครือข่ายเนื่องจากอาจเป็นส่วนหนึ่งของการเชื่อมต่อที่ใช้งานอยู่

## ICMP for Mapping Targets

### การใช้ ICMP ในการทำแผนที่เป้าหมาย

- **Reconnaissance สำคัญ**:
  - การสำรวจเบื้องต้นเป็นสิ่งสำคัญเนื่องจากไม่สามารถโจมตีแบบสุ่มได้เนื่องจากอาจทำให้ตรวจจับได้เร็วหรือเกิดความล้มเหลวทั้งหมด
  - Ringzero เป็น Trojan ที่สแกนพอร์ต 80, 8080 และ 3128 แบบสุ่ม
    - เป็นเวลานานที่ไม่มีใครรู้ว่าการสแกนเหล่านี้เป็นผลมาจาก Ringzero

- **วิธีการทำแผนที่เครือข่าย**:
  - **Brute Force**:
    - Ping ช่วง IP ทั้งหมดที่คาดว่าจะมีอยู่ในเครือข่าย
    - ทำให้เกิดลายเซ็นจำนวนมากที่สามารถตรวจจับโดย IDS
  - **Technique 1**:
    - กระจายข้อความ ICMP โดยใช้ Directed Broadcast
    - ใช้ที่อยู่ a.b.c.0 หรือ a.b.c.255
  - **Technique 2**:
    - ส่งบรอดคาสต์ไปยัง subnet ที่สงสัยว่าอาจมีอยู่
    - ตัวอย่าง: a.b.c.63 จะกระจายไปยัง subnet ที่มี 64 โหนด
  - **Technique 3**:
    - ส่งคำขอ ICMP ไปยังโฮสต์เพื่อตรวจสอบ subnet masks

## Penetration Test

### การทดสอบเจาะระบบ

- **การทดสอบเพื่อหาช่องโหว่**:
  - ทดสอบการหาช่องโหว่ด้านความปลอดภัยโดยการแฮ็กระบบความปลอดภัยด้วยตัวเองหรือจ้างบุคคลที่สาม
  - การทดสอบการปฏิบัติตามนโยบาย
    - ตรวจสอบว่านโยบายขององค์กรได้ถูกควบคุมแล้วหรือไม่
  - การทดสอบสถานะปัจจุบันของระบบความปลอดภัยว่ามีความแข็งแกร่งพอหรือไม่
    - การเปลี่ยนแปลงเครือข่ายและอุปกรณ์อาจทำให้เกิดช่องโหว่ใหม่
  - การทดสอบโดย “Ethical Hacker”

## Standards for Pen Test

### มาตรฐานการทดสอบเจาะระบบ

- **TIGER** (http://www.tigerscheme.org):
  - ก่อตั้งในปี 2007 โดยใช้หลักการของแผนการรับรองทางการค้าซึ่งดำเนินการอย่างอิสระ
- **OWASP** (https://www.owasp.org):
  - Open Web Application Security Project (OWASP) เป็นโครงการชุมชน Open Source ที่พัฒนาซอฟต์แวร์และเอกสารที่ช่วยในการปกป้องเว็บแอปพลิเคชันและบริการเว็บ
- **PCI** (https://www.pcisecuritystandards.org):
  - ก่อตั้งในเดือนธันวาคม 2004 และใช้กับสมาชิก, ผู้ค้าปลีก และผู้ให้บริการที่เก็บ, ประมวลผล หรือส่งข้อมูลบัตร
- **ISACA** (https://www.isaca.org):
  - ก่อตั้งในปี 1967 เป็นองค์กรระดับโลกสำหรับการกำกับดูแลข้อมูล, การควบคุม, ความปลอดภัย และผู้เชี่ยวชาญด้านการตรวจสอบ
- **OSSTMM** (http://www.osstmm.org):
  - The Open Source Security Testing Methodology Manual (OSSTMM) มีจุดมุ่งหมายเพื่อกำหนดมาตรฐานสำหรับการทดสอบความปลอดภัยทางอินเทอร์เน็ต

## What Should You Test?

### สิ่งที่ควรทดสอบ

- **ผลิตภัณฑ์สำเร็จรูป**: เซิร์ฟเวอร์, สมาร์ทโฟน, ไฟร์วอลล์, เราเตอร์ ฯลฯ
- **การพัฒนาซอฟต์แวร์ที่กำหนดเอง**: เว็บไซต์, แอปพลิเคชันมือถือ, เกม ฯลฯ
- **อุปกรณ์โทรศัพท์**: การสับเปลี่ยน, สมาร์ทโฟน, VOIP, เซิร์ฟเวอร์แฟกซ์ ฯลฯ
- **ระบบไร้สาย**: เครือข่าย WIFI, RFID tokens, เงินสดที่ไม่ต้องสัมผัส ฯลฯ
- **การป้องกันทางกายภาพ**: CCTV, ระบบเข้าประตู, กุญแจกลไก ฯลฯ

## Steps for Pentest

### ขั้นตอนในการทดสอบเจาะระบบ

1. **Reconnaissance**:
   - Whois
   - การค้นหาในอินเทอร์เน็ต
   - การดึงข้อมูล DNS Record
   - การสังคมวิศวกรรม
   - การค้นหาในถังขยะ
   - การคัดลอกเว็บไซต์

2. **Exploitation**:
   - การค้นพบและการสำรวจ

3. **Reinforcement**:
   - การทำลายรหัสผ่าน
   - การสแกนช่องโหว่

4. **Making a Final Report**:
   - ให้ข้อเสนอแนะตามนโยบายขององค์กร
